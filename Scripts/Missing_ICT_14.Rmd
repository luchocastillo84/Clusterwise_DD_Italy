---
title: "Treating Missingness in ICT-Usage in Enterprises"
author: "Luis Carlos Castillo"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_depth: 4
  pdf_document:
    toc: yes
params:
  data_year: "ict_14c"
  raw_data: "ICT_2014"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Loading Packages, include=FALSE}
# load the necessary packages
library(readr)
library(readxl)
library(dplyr)
library(tidyr)
library(here)
library(git2r)
library(visdat)
library(naniar)
library(chatgpt)
library(gptstudio)
require(devtools)
library(finalfit)
library(tidyverse)
library(kableExtra)
library(mice)
library(ggmice)
```

```{r Loading Data, echo=FALSE}
# Load the environment
load(here("Scripts", "Environments",  "missing_ict_14.RData"))

dataset <- get(params$data_year)
raw <- get(params$raw_data)

```

## 1. Introduction

This document outlines the treatment of missing data before applying dimensionality reduction using Principal Component Analysis PCA  for the `r params$raw` data frame, which represents the ICT usage in Italian enterprises survey for the year 2014.

### 1.1. Data structure

1.  **Observations:** `r nrow(dataset)`

2.  **Variables:** `r ncol(raw)` 

::: {style="margin-left: +40px;"}
<details>

<summary>Click to see variables</summary>

```{r variables, echo=FALSE}
    knitr::kable(vars_87)

```

</details>

<br>
:::

3.  **Sectors classification before 2017:** `r nlevels(dataset$dom1)` distinct aggregation of sectors

```{r observations by sector1, echo=FALSE, fig.height=7, fig.width=10}
ict_14c %>%
  group_by(dom1) %>%
  summarise(count = n()) %>% 
  ggplot(aes(x = dom1, y = count)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=count), vjust=-0.5) +
  labs(title = "Observations per Sectors", x = "Sectors", y = "Count") +
  theme_minimal() + 
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
        axis.text.y = element_text( hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```


::: {style="margin-left: +40px;"}
<details>

<summary>Click to see sectors list before 2017</summary>

```{r ateco1, echo=FALSE}
knitr::kable(ateco_b17)

```

</details>

<br>
:::

4.  **Sectors classification after 2017:** `r nlevels(dataset$ateco_1)` distinct aggregation of sectors

```{r observations by sector2, echo=FALSE, fig.height=5, fig.width=10}
ict_14c %>%
  group_by(ateco_1) %>%
  summarise(count = n()) %>% 
  ggplot(aes(x = ateco_1, y = count)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=count), vjust=-0.5) +
  labs(title = "Observations per Sectors", x = "Sectors", y = "Count") +
  theme_minimal() + 
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text( hjust = 1, size = 14),
        axis.text.y = element_text( hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```

::: {style="margin-left: +40px;"}
<details>

<summary>Click to see sectors list after 2017</summary>

```{r ateco2, echo=FALSE}
knitr::kable(ateco_a17)

```

</details>

<br>
:::

5.  **Company sizes:** `r nlevels(dataset$clad4)`types based on the number of employees

```{r observations by size, echo=FALSE, fig.height=5, fig.width=5}
levels_clad4 = c("cl1", "cl2", "cl3", "cl4")
labels_clad4 = c("Micro", "Small", "Medium", "Large")

ict_14c %>%
  group_by(clad4) %>%
  summarise(count = n()) %>% 
  ggplot(aes(x = factor(clad4, levels = levels_clad4, labels = labels_clad4), y = count)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=count), vjust=-0.5) +
  labs(title = "Observations per Company Size", x = "Company Size", y = "Count") +
  theme_minimal() + 
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text( hjust = 1, size = 14),
        axis.text.y = element_text( hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```


::: {style="margin-left: +40px;"}
<details>

<summary>Click to see list of companay size</summary>

```{r size, echo=FALSE}
knitr::kable(size)

```

</details>

<br>
:::

6.  **Regions reported:** `r nlevels(dataset$rip)` at the level NUTS 1

```{r observations by region, echo=FALSE, fig.height=5, fig.width=8}
levels_rip4 = c("ITC", "ITF", "ITG", "ITH", "ITI")
labels_rip4 = c("Northwest", "South", "Iisland", "Northeast", "Center")

ict_14c %>%
  group_by(rip) %>%
  summarise(count = n()) %>% 
  ggplot(aes(x = factor(rip, levels = levels_rip4, labels = labels_rip4), y = count)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=count), vjust=-0.5) +
  labs(title = "Observations per Region", x = "Region", y = "Count") +
  theme_minimal()+ 
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text( hjust = 1, size = 14),
        axis.text.y = element_text( hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```

::: {style="margin-left: +40px;"}
<details>

<summary>Click to see list of regions</summary>

```{r regions, echo=FALSE}
knitr::kable(regions)

```

</details>

<br>
:::

## 2. Visualization of the raw data

As we can see the raw data contains `r round(prop_miss(raw)*100,1)`% of missingness and 
`r round(prop_complete(raw)*100,1)`% of complete observations. 

```{r Visualizing Total Missing Data, echo=FALSE}
vis_miss(raw, warn_large_data = FALSE)
```

In the subsequent three illustrations, we delve deeper into various segments of the dataset. These visual representations underscore the patterns of missingness, highlighting instances where specific questions were either unanswered or bypassed by the participating companies. As of our current assessment, the precise nature of this missingness remains ambiguous, pending further tests and comprehensive visual analyses.

At this juncture, establishing a definitive threshold for the removal of variables is challenging. Nonetheless, it might be prudent to contemplate excluding variables with missingness exceeding 60 to 70%. Such decisions should, of course, be informed by the inherent characteristics of each variable and a thorough understanding of the missingness mechanism.

```{r Visualizing partial Missing Data1, echo=FALSE}
vis_miss(raw[, 1:30], warn_large_data = FALSE, show_perc = F)

```

```{r Visualizing partial Missing Data2, echo=FALSE}
vis_miss(raw[, 31:58], warn_large_data = FALSE, show_perc = F)

```

```{r Visualizing partial Missing Data3, echo=FALSE}
vis_miss(raw[, 59:86], warn_large_data = FALSE, show_perc = F)
```

## 3. The nature of missingness 

At this point there are three reasons why data is missing:

**1. Missing Completely at Random MCAR:** This occurs when the probability of missingness is independent of both observed data and the values of the missing data itself. Essentially, the missingness is due to random reasons and is not systematically related to any observed or unobserved variables. For example, if some companies failed to complete a section of questions because the respondent ran out of time or there was an unintentional oversight, and this occurrence is purely random across all types, sizes, and sectors of companies, then the missingness is MCAR. It's akin to a random 'drop out' of data without a specific reason tied to the characteristics of the companies or the values of the questions being unanswered.

**2. Missing At Random (MAR):** This occurs when the probability of missingness depends on other observed data but not on the values of the missing data itself. For example, if larger enterprises consistently skip a section of questions due to their size (and you have information about the size of every enterprise), then the missingness is MAR. You have observed data (enterprise size) that can explain the missingness pattern.

**3. Missing Not At Random (MNAR):** This is when the missingness depends on the values of the missing data itself. For instance, if companies that don't use any cloud computing services skip these questions, then the missingness is related to the fact they don't use these services â€“ information which is unobserved because it's the very thing that's missing.

### 3.1. Missingness by group of variables, regions sectors and sizes

In this dataset, we delve into the patterns of missingness across various dimensions, specifically regions, sectors, and enterprise sizes. This exploration is pivotal for myriad reasons. Different regions, influenced by diverse business climates and technological infrastructures, might showcase unique response patterns. In a similar vein, enterprises from varied sectors could have distinct tendencies to respond to certain queries, particularly those pertaining to technological utilization or industry-specific subtleties. Furthermore, the enterprise size often plays a role in dictating its available resources, capacities, and occasionally, its predisposition to provide or omit particular data. Through an in-depth analysis of the missingness within these parameters, our objective is to decipher inherent patterns or tendencies that can guide our approach to data imputation strategies or other relevant data treatments.

Building on this, the subsequent section offers visual depictions of three specific categories of variables:

1. Website usage by companies, exhibiting 26% missingness. (9 binary variables)
2. Cloud computing adoption, with a missingness rate of 58%. (9 binary variables)
3. Cloud computing category of benefits to companies, with a missing rate of 58%. (3 categorical variables)
4. Percentage of Types of invoices issued, which shows a 30% rate of missingness. (3 numeric variables)

#### 3.1.1. Website usage by companies, by sectors and size 

The high rate of missingness among micro-enterprises in the construction (N11) sector, paired with a similarly high proportion of companies reporting '0' (indicating non-use of websites), suggests that these businesses either:

- Have little to no relevance for using websites in their daily operations and might have opted to skip the questions.
- Perhaps find the questionnaire or the related section to be less pertinent to their operations.

This leans towards Missing Not At Random (MNAR), since the missingness seems to depend on the underlying (unobserved) value of the variable.

**-Sectoral Differences:**

Different sectors have different digital needs and capabilities. For instance, micro-enterprises in the construction(N11) sector may not see the immediate benefit of having a website, especially if they operate on local, word-of-mouth referrals. In contrast, even small retail traders (N13, N14) might consider a website more essential due to the nature of their business.

**-Company Size Matters:**

It's no surprise that larger companies might have more complete data. They typically have more resources, better-defined processes, and often a more substantial digital presence, making it more likely for them to provide complete information. This observation underscores the importance of considering company size when analyzing missingness and determining imputation strategies.

```{r web missing by size, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company size
ggplot(long_data, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Website Services by Sector, Segmented by Size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```

#### 3.1.2. Website usage by companies, by sectors and region 

**Regional Patterns:**

The fact that four out of five regions show a consistent pattern suggests that there is a general trend across most regions. However, the island region exhibiting a similar pattern but with a reduced magnitude may be influenced by geographical, infrastructural, or socio-economic factors unique to island regions. For example, businesses on islands might have more localized trade and might not prioritize digital presence as much as those in more urban or mainland areas.

**Consistency Across Sectors:**

It's evident that regardless of the region, certain sectors (construction and wholesale/retail trade) are more prone to report '0' for website use. This further strengthens the notion that certain sectors, regardless of their geographical location, find limited value or relevance in having a website.

The missingness in the website use variable still leans towards MNAR. This is primarily because the decision to skip or not respond to the question (resulting in missing data) seems closely tied to the underlying value that the variable would have taken if it were observed. For instance, a construction firm with no website or no inclination to have one might be more likely to skip the question about website usage.


```{r missing by region, echo=FALSE, fig.height=13, fig.width=13}

# Plot with facets by company regions
ggplot(long_data, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Website Services by Sector, Segmented by Region", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))

```


#### 3.2.1. Cloud computing adoption by companies, by sector and size

**Consistent Missingness in Micro-Enterprises:** For both website and cloud computing usage, the micro-enterprises, especially in sectors like construction and retail trade, have displayed significant missingness. This aligns with the MNAR assumption: smaller businesses, perhaps due to limited resources or perceived irrelevance, might skip questions related to certain technological solutions they don't employ.

```{r cloud missing by size, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company size
ggplot(long_data, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Website Services by Sector, Segmented by Size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```



#### 3.2.2. Cloud computing adoption by companies, by sector and region

**Regional Variation:** The regional patterns highlight specific geographical areas with consistent missingness, suggesting the existence of regional influences on the adoption of cloud computing. For example, the Northeast and Northwest regions display missing values across all sectors, whereas the Island, South, and Center regions show missingness only in certain sectors.

**Specific Sectors:** The salient sectors that display a pattern of missing data across different regions further solidify the notion that certain industries might be less inclined to adopt or even answer questions about cloud computing, possibly due to the nature of their business or their size. For instance, it makes sense for construction and certain traditional trades to potentially have less engagement with cloud computing than more technologically inclined sectors.

Given the evidence, the nature of the missingness for cloud computing appears to be MNAR. The patterns seem to suggest that missingness is not random but likely contingent on some unobserved factors such as a company's actual non-use of cloud computing or perhaps perceptions related to the relevance of cloud computing for their specific sector.

This understanding of MNAR is crucial for imputation strategies. While certain techniques like Multiple Imputation can handle MAR more effectively, MNAR poses more challenges because the missingness mechanism relates to the unobserved data itself. Careful consideration of the underlying reasons for missingness will be crucial in any imputation or modeling strategy you pursue.

```{r cluod miss by region, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company region
ggplot(long_data1, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Cloud computing adoption by Sector, Segmented by Size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
 theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```


#### 3.3.1. Cloud computing category of benefits to companies, by sector and size

```{r cloud benefits by size, echo=FALSE, fig.height=13, fig.width=13}


# Plot with facets by company size
ggplot(long_data1a, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Cloud computing adoption by Sector, Segmented by Size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```




```{r cloud benefits by region, eval=FALSE, fig.height=13, fig.width=13, include=FALSE}
#### 3.3.2. Cloud computing category of benefits to companies, by sector and region

# Plot with facets by company region
ggplot(long_data1a, aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Missing Data Distribution for Cloud computing benefits by Sector, Segmented by Region", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip, ncol = 1, scales = "free_x") +  # adjust ncol based on how many panels you want per row
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```


#### 3.4.1.1. Auto-process invoices issued by companies, by sector and size

```{r auto-process invoices by size, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company size
long_data2 %>% filter(variable == "I2a") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of Auto-Process Invoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4 + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```



```{r auto-process invoices by region, eval=FALSE, fig.height=13, fig.width=13, include=FALSE}

#### 3.4.1.2. Auto-process invoices issued by companies, by sector and region
# Plot with facets by company Region
long_data2 %>% filter(variable == "I2a") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of Auto-Process Invoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))

```



#### 3.4.2.1. Manual e-invoices issued by companies, by sector and size

```{r Manual e-invoices by size, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company size
long_data2 %>% filter(variable == "I2b") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of Manual e-Invoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4 + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```



```{r Manual e-invoices by region, eval=FALSE, fig.height=13, fig.width=13, include=FALSE}
#### 3.4.2.2. Manual e-invoices issued by companies, by sector and region
# Plot with facets by company Region
long_data2 %>% filter(variable == "I2b") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of Manual e-Invoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```



#### 3.4.3.1. Paper invoices issued by companies, by sector and size

```{r paper invoices by size, echo=FALSE, fig.height=13, fig.width=13}
# Plot with facets by company size
long_data2 %>% filter(variable == "I2c") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of paper in oinvoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ clad4 + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```



```{r paper invoices by region, eval=FALSE, fig.height=13, fig.width=13, include=FALSE}
#### 3.4.3.2. Paper invoices issued by companies, by sector and region
# Plot with facets by company Region
long_data2 %>% filter(variable == "I2c") %>%  ggplot(aes(x = dom1, fill = categorized)) +
  geom_bar(position = "stack") +
  labs(title = "Distribution of paper invoices by Sector and size", 
       x = "Economic Sector", y = "Count", fill = "Category") +
  facet_wrap(~ rip + variable, ncol = 1, scales = "free_x") +  # facet by both size and variable
  theme(plot.title = element_text(size = 18),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 14),
        axis.text.y = element_text(angle = 45, hjust = 1, size = 14),
        axis.title.y = element_text(size = 16),
        axis.title.x = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        strip.text = element_text(size = 14))
```


## 4. Imputation process

The imputation process commenced with a focus on variables that had up to 60% of missing values. These variables form the foundation of our analysis and any missing values within them can skew our results. To address this, we utilized the mice package in R, a renowned package designed to handle missing data imputations. Recognizing the inherent diversity and variability in our dataset, a set of covariates were strategically chosen to guide the imputation process. Additionally other covariates were included as listed in each imputation process. Among these covariates,were included the sectors in which companies operated, the size of the company, and the region of operation. Given that these covariates inherently possessed different levels (sectors, sizes, and regions), it was imperative to implement a one-hot encoding approach. This transformed the categorical data into a format suitable for effective imputation, ensuring that the generated data is both representative and meaningful for subsequent analyses.

### 4.1. Website use

**Group of 9 variables with missing values**
Companies services offered by the website. 

-C8a. Possibility to place orders or reservations online (e.g. online shopping cart)

-C8b. Online traceability of the order

-C8c. Access to product catalogues or price lists

-C8d. Ability to customize site content for regular visitors

-C8e. Ability for site visitors to customize or design products

-C8f. Privacy Policy Notices, Privacy Certification Mark, or Site Security Certification

-C8g. Announcement of job vacancies or possibility of making job applications online

-C8h. Links or references to the company's social media profiles

-C8i. Possibility to submit complaints online (via email, web form, etc.)

**Group of covariates used for imputations**

-B5a. Using IT specialists who are part of the business group

-B1. 	Employment of IT specialists

-C9c. SM usage by type: multimedia content sharing websites 

-dom1. economic sectors

-clad4. size by No. of employees

-rip. regions NUTS 1 for Italy


#### 4.1.1. Traceplot after imputation

The trace plots display the imputation parameters over 15 iterations for five imputed datasets (m=5). Key observations include:

**- Convergence:** Most trajectories stabilize by the later iterations, indicating convergence.

**- Variability:** There's some variability between imputed datasets, but trajectories are reasonably consistent across sets.

**- Method:** The cart method was used for imputation. Compared to other methods like logreg (logistic regression) and pmm (predictive mean matching), cart (Classification and regression trees) demonstrated favorable performance in regression diagnostics.


```{r model1 websites traceplot, echo=FALSE, fig.height=13, fig.width=13}

plot_trace(imp_model_ws3)

```

#### 4.1.2. Post-imputation diagnostics

**- Accuracy:** This is the proportion of correctly predicted classifications in the test set. A higher accuracy indicates better performance, but it can be misleading if classes are imbalanced.

**- AUC:** AUC (Area under the ROC Curve) measures the ability of the model to distinguish between the positive and negative classes. An AUC of 0.5 suggests no discrimination (equivalent to random guessing), and an AUC of 1.0 indicates perfect discrimination. AUC is a widely used metric because it's less affected by imbalanced classes.

**- Original data:** After removing the missing values using the original data the
model gives the following results.

`r paste("**Accuracy for Model Org:**", round(acc_org_ws,4))`

`r paste("**AUC for Model Org:**", round(auc_org_ws,4))`

**- Imputed data:** The cart imputed data marginally improved accuracy, though AUC observed a slight decrease. The consistency between the original and imputed data's performance metrics suggests that the imputation was successful.

`r paste("**Accuracy for Model 3:**", round(acc_ws3,4))`

`r paste("**AUC for Model 3:**", round(auc_ws3,4))`


### 4.2. Cloud computing adoption

**Group of 9 variables with missing values**


Which cloud computing services used on the Internet are purchased by the company:
-D2a. Email services

-D2b. Office software (e.g., word processors, spreadsheets)

-D2c. Enterprise database hosting

-D2d. File storage

-D2e. Finance and accounting software applications

-D2f. CRM (Customer Relationship Management) software applications to manage information relating to your customers

-D2g. Computing power to run the company's software

How the cloud computing services used on the Internet purchased by the company are provided.

-D3a. Through cloud service provider servers that are not reserved exclusively for the company

-D3b. Through servers of the cloud service provider which are reserved exclusively for the company

**Group of covariates used for imputations**

-B5a. Using IT specialists who are part of the business group

-C7. 	Websites

-C9c. SM usage by type: multimedia content sharing websites 

-dom1. economic sectors

-clad4. size by No. of employees

-rip. regions NUTS 1 for Italy

#### 4.2.1. Traceplot after imputation

**Convergence:** The trace plot indicates convergence for most of the variables, as many of the trajectories stabilize or show a consistent pattern across the iterations. This suggests that 15 iterations (maxit=15) may be adequate for the CART imputation method in reaching equilibrium for these variables.

**Variability:** There's noticeable variability across the trajectories for different imputed datasets, but it remains within a reasonably close range. This is characteristic of multiple imputations and signifies the inherent randomness when estimating the missing data's distribution. While variability is expected, it's crucial that the range remains reasonably tight, as overly dispersed trajectories might hint at potential model inadequacies or the need for more iterations.


**Methods:** The employed method for imputation is CART (m=7 imputed datasets). CART is a decision tree-based method that can handle non-linear patterns and interactions effectively. Comparing this with other methods such as logistic regression (logreg) and random forests (rf), CART tends to be more interpretable and can handle categorical data naturally. While logreg is more suited for linear relationships and rf is a robust ensemble technique, the selected method should ideally align with the data's characteristics and the specific challenges posed by its missing values.

```{r model1 cloud computing traceplot, echo=FALSE, fig.height=13, fig.width=13}

plot_trace(imp_model_cc3)

```


#### 4.2.2. Post-imputation diagnostics

**- Original data:** After removing the missing values using the original data the model gives the following results.

`r paste("**Accuracy for Model Org:**", round(acc_org_cc1,4))`

`r paste("**AUC for Model Org:**", round(auc_org_cc1,4))`


**- Imputed data:** Post-imputation using the CART method, the accuracy improved slightly to 0.7229. More notably, the AUC saw a significant boost, reaching 0.9032. This could suggest that the CART imputation process has added value to the predictive model by rectifying certain data biases or filling in critical missing patterns.

`r paste("**Accuracy for Model 3:**", round(acc_cc3,4))`

`r paste("**AUC for Model 3:**", round(auc_cc3,4))`


### 4.3. Type of invoices adoption

**Group of 9 variables with missing values**


Which cloud computing services used on the Internet are purchased by the company:
-D2a. Email services

-D2b. Office software (e.g., word processors, spreadsheets)

-D2c. Enterprise database hosting

-D2d. File storage

-D2e. Finance and accounting software applications

-D2f. CRM (Customer Relationship Management) software applications to manage information relating to your customers

-D2g. Computing power to run the company's software

How the cloud computing services used on the Internet purchased by the company are provided.

-D3a. Through cloud service provider servers that are not reserved exclusively for the company

-D3b. Through servers of the cloud service provider which are reserved exclusively for the company

**Group of covariates used for imputations**

-B5a. Using IT specialists who are part of the business group

-C7. 	Websites

-C9c. SM usage by type: multimedia content sharing websites 

-dom1. economic sectors

-clad4. size by No. of employees

-rip. regions NUTS 1 for Italy

#### 4.3.1. Traceplot after imputation

**Convergence:** 

**Variability:** 


**Methods:** 

```{r model1 type of invoices traceplot, echo=FALSE, fig.height=13, fig.width=13}

plot_trace(imp_model_ti3)

```


#### 4.3.2. Post-imputation diagnostics

**- Original data:** After removing the missing values using the original data the model gives the following results.

`r paste("**Accuracy for Model Org:**", round(acc_org_cc1,4))`

`r paste("**AUC for Model Org:**", round(auc_org_cc1,4))`


**- Imputed data:** Post-imputation using the CART method, the accuracy improved slightly to 0.7229. More notably, the AUC saw a significant boost, reaching 0.9032. This could suggest that the CART imputation process has added value to the predictive model by rectifying certain data biases or filling in critical missing patterns.

`r paste("**Accuracy for Model 3:**", round(acc_cc3,4))`

`r paste("**AUC for Model 3:**", round(auc_cc3,4))`








